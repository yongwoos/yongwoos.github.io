---
title: iptables
weight: 8
---
# **ğŸ”¹ iptablesë€? (Kubernetesì—ì„œ íŠ¸ë˜í”½ì„ ë¼ìš°íŒ…í•˜ëŠ” í•µì‹¬ êµ¬ì„± ìš”ì†Œ)**  
`iptables`ëŠ” ë¦¬ëˆ…ìŠ¤ì—ì„œ íŒ¨í‚· í•„í„°ë§ ë° ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œ ë³€í™˜(NAT)ì„ ìˆ˜í–‰í•˜ëŠ” **ë°©í™”ë²½ ë° íŒ¨í‚· ì²˜ë¦¬ ë„êµ¬**ë‹¤.  
ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œëŠ” **kube-proxyê°€ iptables ê·œì¹™ì„ ì„¤ì •í•˜ì—¬ ì„œë¹„ìŠ¤ íŠ¸ë˜í”½ì„ ì ì ˆí•œ Podë¡œ ë¼ìš°íŒ…**í•œë‹¤.  

---

## **ğŸ“Œ Kubernetesì—ì„œ iptables ì—­í• **
âœ… **1. ì„œë¹„ìŠ¤ì˜ í´ëŸ¬ìŠ¤í„° IP(ê°€ìƒ IP)ë¥¼ Podì˜ ì‹¤ì œ IPë¡œ ë§¤í•‘**  
âœ… **2. NodePort ì„œë¹„ìŠ¤ì˜ íŠ¸ë˜í”½ì„ ì ì ˆí•œ ë…¸ë“œì˜ Podë¡œ ì „ë‹¬**  
âœ… **3. ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ë‚´ë¶€ Podë¡œ ì „ë‹¬ (DNAT ì ìš©)**  
âœ… **4. Pod ê°„ í†µì‹ ì„ ì œì–´í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ ì •ì±… ì ìš© ê°€ëŠ¥**  

---

## **ğŸ“Œ 1. iptablesë¥¼ í™œìš©í•œ ì„œë¹„ìŠ¤ íŠ¸ë˜í”½ íë¦„**  
### **ğŸ”¹ ì„œë¹„ìŠ¤ ìƒì„± í›„ iptables ë³€í™” ì˜ˆì œ**  
```sh
kubectl apply -f my-service.yaml
```
```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: my-app
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
```
- `my-service`ê°€ ìƒì„±ë˜ë©´ `kube-proxy`ê°€ iptables ê·œì¹™ì„ ì„¤ì •  

---

## **ğŸ“Œ 2. iptables ê·œì¹™ í™•ì¸**
### **âœ… iptables NAT í…Œì´ë¸” í™•ì¸**
```sh
iptables -t nat -L -n -v | grep my-service
```
ì¶œë ¥ ì˜ˆì‹œ:
```
DNAT       tcp  --  0.0.0.0/0   10.96.0.50  tcp dpt:80 -> 10.244.1.10:8080
DNAT       tcp  --  0.0.0.0/0   10.96.0.50  tcp dpt:80 -> 10.244.2.15:8080
```
**ğŸ’¡ í•´ì„:**  
- `10.96.0.50` (my-serviceì˜ Cluster IP)ë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ **Pod IP(10.244.1.10, 10.244.2.15)ë¡œ ì „ë‹¬**  
- `targetPort: 8080`ì— ë§ì¶° ë³€í™˜ë¨  

### **âœ… iptables í•„í„° í…Œì´ë¸” í™•ì¸**
```sh
iptables -t filter -L -n -v
```
- Pod ê°„ í†µì‹ ì´ í—ˆìš©ë˜ëŠ”ì§€ í™•ì¸ ê°€ëŠ¥  

---

## **ğŸ“Œ 3. iptables ê¸°ë°˜ íŠ¸ë˜í”½ íë¦„ ì˜ˆì œ**
### **ğŸ”¹ `my-service`ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ íë¦„**
1ï¸âƒ£ `curl my-service:80` ìš”ì²­ ì‹œ, **DNS ì¡°íšŒë¥¼ í†µí•´ í´ëŸ¬ìŠ¤í„° IP(10.96.0.50) íšë“**  
2ï¸âƒ£ **iptables NAT ê·œì¹™ì„ í™•ì¸í•˜ì—¬ ìš”ì²­ì„ Pod IP(10.244.1.10:8080)ë¡œ í¬ì›Œë”©**  
3ï¸âƒ£ `kube-proxy`ê°€ `iptables`ì„ ì‚¬ìš©í•˜ì—¬ **íŠ¸ë˜í”½ì„ ì ì ˆí•œ Podë¡œ ì „ë‹¬**  
4ï¸âƒ£ **Podì—ì„œ ì‘ë‹µ í›„ í´ë¼ì´ì–¸íŠ¸ë¡œ ë°˜í™˜**  

---

## **ğŸ“Œ 4. iptables ê¸°ë°˜ NodePort ë™ì‘ ë°©ì‹**
```sh
kubectl expose deployment my-app --type=NodePort --port=80 --target-port=8080
```
NodePortë¥¼ ì‚¬ìš©í•˜ë©´ **ëª¨ë“  ë…¸ë“œì˜ íŠ¹ì • í¬íŠ¸(ì˜ˆ: 30080)ì—ì„œ íŠ¸ë˜í”½ì„ ë°›ì„ ìˆ˜ ìˆìŒ**  

### **ğŸ”¹ iptables NAT ê·œì¹™ ì˜ˆì œ**
```sh
iptables -t nat -L -n -v | grep 30080
```
```
DNAT       tcp  --  0.0.0.0/0   192.168.56.101  tcp dpt:30080 -> 10.244.1.10:8080
```
**ğŸ’¡ í•´ì„:**  
- `192.168.56.101:30080`ìœ¼ë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ **Pod(10.244.1.10:8080)ë¡œ ì „ë‹¬**  

---

## **âœ… ì •ë¦¬**
âœ” **ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” `kube-proxy`ë¥¼ í†µí•´ iptables ê·œì¹™ì„ ìë™ ì„¤ì •**  
âœ” **ClusterIP ì„œë¹„ìŠ¤ëŠ” ê°€ìƒ IPë¥¼ í†µí•´ Podë¡œ íŠ¸ë˜í”½ì„ ë¼ìš°íŒ…**  
âœ” **NodePort ì„œë¹„ìŠ¤ëŠ” ëª¨ë“  ë…¸ë“œì˜ íŠ¹ì • í¬íŠ¸ë¥¼ í†µí•´ ì ‘ê·¼ ê°€ëŠ¥**  
âœ” **iptables NATì„ í™œìš©í•˜ì—¬ íŒ¨í‚·ì˜ ëª©ì ì§€ë¥¼ Podë¡œ ë³€ê²½**  

> ğŸš€ **iptablesëŠ” Kubernetes ì„œë¹„ìŠ¤ ë¼ìš°íŒ…ì˜ í•µì‹¬ ì—­í• ì„ ìˆ˜í–‰!**