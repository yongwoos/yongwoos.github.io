---
title: TLS
weight: 1
---
## TLS 핸드쉐이크 과정에서의 공개키와 비밀키, 그리고 세션 키 생성 과정
### 1. **서버 인증 및 공개키 제공**
   - **서버**는 자신의 **디지털 인증서**를 클라이언트에게 보냅니다.
   - 이 인증서에는 서버의 **공개키**가 포함되어 있습니다. 이 공개키는 서버가 신뢰할 수 있는 **CA**(Certificate Authority)에 의해 서명된 인증서입니다.
   - 클라이언트는 서버의 인증서를 확인하여 서버가 신뢰할 수 있는지 확인하고, 서버의 공개키를 사용해 이후 통신을 암호화합니다.

### 2. **Pre-Master Secret 생성 및 암호화**
   - **클라이언트**는 서버의 **공개키**를 사용해 **Pre-Master Secret**을 암호화하여 서버에 전송합니다.
   - 이때 클라이언트가 생성하는 **Pre-Master Secret**은 **양측이 동일한 세션 키**를 생성할 수 있는 중요한 값입니다.
   - 왜냐하면 이 **Pre-Master Secret**을 바탕으로 **세션 키**가 만들어지기 때문입니다.

### 3. **서버가 Pre-Master Secret 복호화**
   - 서버는 자신의 **비밀키**를 사용하여 클라이언트가 보낸 **Pre-Master Secret**을 복호화합니다.
   - 복호화된 **Pre-Master Secret**은 클라이언트와 서버가 **세션 키**를 생성하는 데 사용됩니다.

### 4. **세션 키 생성**
   - 서버와 클라이언트는 이 **Pre-Master Secret**을 사용하여 **세션 키**를 생성합니다. 세션 키는 **대칭 키**로, 양쪽이 동일한 세션 키를 사용하여 데이터를 암호화하고 복호화할 수 있게 됩니다.
   - 세션 키는 **대칭 암호화** 방식으로 사용되며, 이는 데이터 전송 중에 **빠르고 효율적으로** 데이터를 암호화할 수 있게 해줍니다.

### 5. **세션 키를 이용한 데이터 암호화**
   - **세션 키**는 클라이언트와 서버가 안전하게 데이터를 주고받을 수 있도록 암호화와 복호화에 사용됩니다. 이후 모든 통신은 이 세션 키를 사용하여 암호화되고 복호화됩니다.

### 요약
- **서버는 공개키를 클라이언트에게 제공**하고, 클라이언트는 이 공개키로 **Pre-Master Secret**을 암호화해서 서버로 보냅니다.
- 서버는 **자신의 비밀키**로 이를 **복호화**하여 **세션 키**를 생성합니다.
- **세션 키**는 대칭 암호화 방식으로 데이터를 암호화하고 복호화하는 데 사용되며, 이후 **TLS 통신**은 이 세션 키를 사용해 안전하게 이루어집니다.

이 과정에서 중요한 점은 **비대칭 암호화**(공개키/비밀키)가 초기에 **Pre-Master Secret**을 안전하게 교환하는 데 사용되고, 그 후의 데이터 전송은 **대칭 암호화**(세션 키)를 통해 이루어진다는 것입니다.

## TLS 세부 과정
**TLS(Transport Layer Security)**는 네트워크 상에서 데이터를 안전하게 암호화하고 무결성을 보장하는 프로토콜입니다. TLS는 특히 웹에서 중요한 역할을 하며, 주로 **HTTPS**(HTTP over TLS) 프로토콜로 사용됩니다. TLS 연결을 설정하는 과정은 여러 단계로 이루어져 있으며, 클라이언트와 서버 간에 안전한 통신을 보장하는 데 필요한 모든 절차를 포함합니다. 아래에서는 TLS 핸드쉐이크 과정과 각 단계에서 발생하는 세부적인 절차를 설명합니다.

### 1. **TLS 핸드쉐이크(Handshake) 과정**

TLS 핸드쉐이크는 클라이언트와 서버가 서로의 신뢰성을 확인하고, 데이터를 암호화하기 위한 키를 교환하며, 안전한 연결을 설정하는 과정입니다. 핸드쉐이크는 기본적으로 4개의 주요 단계로 이루어집니다.

#### 1.1 클라이언트 헬로우(ClientHello)
클라이언트는 서버와의 연결을 시작할 때 **ClientHello** 메시지를 보냅니다. 이 메시지에는 클라이언트가 지원하는 TLS 버전, 암호화 방식(암호화 스위트), 압축 방법 등 여러 가지 정보가 포함됩니다.

- **TLS 버전**: 클라이언트가 지원하는 TLS 버전을 서버에 알려줍니다.
- **암호화 스위트(Cipher Suite)**: 클라이언트가 지원하는 암호화 알고리즘 목록을 보냅니다. 예를 들어, RSA 또는 ECC 기반의 암호화, 해시 알고리즘(SHA256), 키 교환 알고리즘(예: RSA, Diffie-Hellman)을 포함합니다.
- **세션 ID**: 이미 TLS 세션이 존재하면, 그 세션의 ID를 포함하여 세션 재사용을 시도할 수 있습니다.
- **랜덤 값(Random)**: 클라이언트는 랜덤한 데이터를 생성하여 서버에 보냅니다. 이 랜덤 값은 후속 과정에서 키 생성에 사용됩니다.

#### 1.2 서버 헬로우(ServerHello)
서버는 클라이언트로부터 **ClientHello** 메시지를 받은 후, 자신의 응답을 **ServerHello** 메시지로 보냅니다. 이 메시지는 클라이언트와 서버가 상호 합의한 **TLS 버전**과 **암호화 방식**을 포함하고 있습니다.

- **서버의 인증서**: 서버는 자신이 신뢰할 수 있는 인증 기관(CA)에서 발급받은 **디지털 인증서**를 클라이언트에게 전달합니다. 이 인증서는 서버의 공개 키를 포함하고 있습니다.
- **랜덤 값(Random)**: 서버는 서버의 랜덤 값을 생성하여 클라이언트에게 보냅니다. 이 값은 후속 키 생성 과정에 사용됩니다.
- **암호화 스위트**: 서버는 클라이언트가 제시한 암호화 스위트 중 하나를 선택하여 클라이언트에게 알립니다.
- **세션 ID**: 서버는 세션 ID를 생성하여 클라이언트에게 보냅니다. 이를 통해 같은 클라이언트가 후속 요청을 보낼 때 TLS 핸드쉐이크를 생략할 수 있습니다.

#### 1.3 키 교환(Key Exchange)
이 단계에서는 클라이언트와 서버가 공유 비밀 키를 생성하기 위해 다양한 방식으로 암호화된 키 교환을 수행합니다.

- **서버 인증서 확인**: 클라이언트는 서버가 제공한 인증서를 확인하여 서버가 실제로 신뢰할 수 있는 서버인지 검증합니다.(CA공개키로 인증서 복호화) 인증서가 유효하고 신뢰할 수 있는 경우, 클라이언트는 서버의 공개 키를 사용하여 키 교환을 준비합니다.
- **Pre-Master Secret 생성**: 클라이언트와 서버는 서로 랜덤 값을 기반으로 **Pre-Master Secret**을 생성합니다. 이 값은 나중에 세션 키를 생성하는 데 사용됩니다.
    - **RSA** 방식을 사용할 경우, 클라이언트는 서버의 공개 키로 Pre-Master Secret을 암호화하여 서버로 전송합니다.
    - **Diffie-Hellman**(DH) 또는 **Elliptic Curve Diffie-Hellman**(ECDH) 방식을 사용할 경우, 클라이언트와 서버는 각각 비공개 값을 사용하여 공유 비밀을 안전하게 계산합니다.
  
#### 1.4 세션 키(Session Key) 생성
**Pre-Master Secret**이 교환되면, 클라이언트와 서버는 이 값을 사용해 **세션 키**를 생성합니다. 세션 키는 대칭 키 알고리즘(예: AES)으로 암호화 및 복호화를 수행할 때 사용됩니다.

- **세션 키 생성**: 클라이언트와 서버는 **Pre-Master Secret**과 각자의 랜덤 값(클라이언트와 서버에서 각각 생성한 랜덤 값)을 결합하여 세션 키를 생성합니다. 이를 통해 **대칭 키**가 생성됩니다.
- **Finished 메시지**: 클라이언트와 서버는 각각 **Finished** 메시지를 보내어 서로가 같은 세션 키를 사용하고 있음을 확인합니다. 이 메시지는 **MAC**(Message Authentication Code) 값을 포함하여 메시지의 무결성을 검사합니다.

#### 1.5 암호화된 데이터 전송
이 단계에서부터 클라이언트와 서버는 **세션 키**를 사용하여 데이터를 **암호화된 형태**로 주고받습니다. 대칭 키 암호화 방식(AES, ChaCha20 등)을 사용하여 데이터의 기밀성과 무결성을 보장합니다.

- **암호화된 통신**: 클라이언트와 서버는 세션 키를 사용하여 데이터를 암호화하고 복호화합니다.
- **데이터 무결성**: 데이터를 전송할 때마다 **MAC**(Message Authentication Code)를 추가하여 데이터가 변경되지 않았음을 확인합니다.

### 2. **핸드쉐이크 외의 과정**

#### 2.1 세션 재사용(Session Resumption)
TLS에서는 **세션 재사용**을 지원하여, 동일한 클라이언트와 서버 간에 핸드쉐이크 과정을 다시 수행하지 않고 빠르게 연결을 재개할 수 있습니다. 세션 재사용은 클라이언트와 서버가 세션 ID 또는 **Session Ticket**을 사용하여 이전 세션을 재활용하는 방식입니다.

#### 2.2 연결 종료(Closure)
TLS 연결이 종료되면, 클라이언트와 서버는 **close_notify** 메시지를 보내어 연결 종료를 알립니다. 이 메시지는 반드시 전송되어야 하며, 이는 상대방에게 "이 연결을 더 이상 사용하지 않겠다"는 신호를 보냅니다.

---

### 요약
- **TLS 핸드쉐이크 과정**은 클라이언트와 서버 간의 안전한 연결을 설정하기 위한 중요한 단계들로, 클라이언트와 서버는 서로 인증하고, 키를 교환하고, 세션 키를 생성한 후 암호화된 통신을 시작합니다.
- TLS는 데이터의 **기밀성**, **무결성**, **인증**을 보장하며, 클라이언트와 서버 간에 **대칭 키 암호화**를 사용하여 안전하게 데이터를 전송합니다.
- **세션 재사용** 및 **세션 티켓** 기능을 통해 TLS 핸드쉐이크를 최적화하여 연결 성능을 향상시킬 수 있습니다.

이러한 과정을 통해 TLS는 인터넷 상의 보안을 강화하고, 해커가 데이터를 도청하거나 변조하는 것을 방지합니다.